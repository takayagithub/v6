<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Affinia - AIタイプ診断</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="style.css">

  <style>
    /* トップのヒーローと診断カード用の追加スタイル */

    .top-wrapper {
      max-width: 640px;
      margin: 0 auto;
      padding: 16px 16px 32px;
    }

    .hero-card {
      background: #fff;
      border-radius: 18px;
      padding: 18px 18px 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.05);
      margin-bottom: 18px;
    }

    .hero-kicker {
      font-size: 11px;
      color: #c149c5;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .hero-title {
      font-size: 20px;
      font-weight: 700;
      margin: 4px 0 6px;
    }

    .hero-copy {
      font-size: 14px;
      color: #555;
      margin: 0 0 10px;
    }

    .hero-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px 12px;
      font-size: 12px;
      color: #777;
      margin-bottom: 10px;
    }

    .hero-meta span {
      padding: 3px 8px;
      border-radius: 999px;
      background: #fbe3f1;
    }

    .hero-main-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      background: #f48bbd;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      margin-top: 4px;
    }

    .hero-sub {
      font-size: 12px;
      color: #888;
      margin-top: 8px;
    }

    /* 診断カード */
    .quiz-section {
      margin-top: 8px;
    }

    .quiz-card {
      background: #fff;
      border-radius: 18px;
      padding: 16px 16px 18px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.05);
    }

    .quiz-header {
      border-bottom: 1px solid #f1d5e6;
      padding-bottom: 6px;
      margin-bottom: 10px;
    }

    .quiz-header-top {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .quiz-title {
      font-size: 15px;
      font-weight: 700;
    }

    .quiz-step {
      font-size: 12px;
      color: #777;
    }

    .quiz-progress-wrapper {
      margin-top: 6px;
    }

    .quiz-progress-bar-bg {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #fde1f0;
      overflow: hidden;
    }

    .quiz-progress-bar {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #f48bbd, #c149c5);
      transition: width 0.2s ease;
    }

    .quiz-progress-text {
      margin-top: 4px;
      font-size: 11px;
      color: #888;
      text-align: right;
    }

    .quiz-body {
      margin-top: 10px;
    }

    /* 質問：常に2行ぶんスペース確保 */
    .quiz-question {
      font-size: 18px;
      margin: 6px 0 12px;
      text-align: center;
      line-height: 1.5;
      min-height: 3.2em; /* 約2行 */
      display: flex;
      align-items: center;
      justify-content: center;
      text-wrap: balance;
    }

    /* 5段階バブル + ラベル（上段バブル / 下段ラベル） */
    .quiz-scale {
      display: grid;
      grid-template-rows: auto auto;
      grid-template-columns: 1fr 1fr;
      row-gap: 12px;
      width: 100%;
      max-width: 320px;
      margin: 0 auto;
    }

    .quiz-bubbles {
      grid-row: 1;
      grid-column: 1 / 3;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      width: 100%;
    }

    .quiz-label {
      font-size: 13px;
      color: #777;
      line-height: 1.4;
      max-width: 120px;
      padding: 0 4px;
      min-height: 4.2em; /* 約3行 */
      word-break: normal;
    }

    .quiz-label:first-child {
      grid-row: 2;
      grid-column: 1;
      justify-self: flex-start;
    }

    .quiz-label:last-child {
      grid-row: 2;
      grid-column: 2;
      justify-self: flex-end;
      text-align: right;
    }

    .quiz-bubble {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid #f0cfe0;
      background: #fff;
      cursor: pointer;
      position: relative;
      transition: transform 0.12s ease, background 0.18s ease,
                  border-color 0.18s ease, box-shadow 0.18s ease;
    }

    .quiz-bubble::after {
      content: "";
      position: absolute;
      inset: 6px;
      border-radius: 50%;
      background: transparent;
    }

    /* 両端大きく・中央小さく */
    .quiz-bubble.level-3 { transform: scale(0.90); }
    .quiz-bubble.level-2,
    .quiz-bubble.level-4 { transform: scale(1.00); }
    .quiz-bubble.level-1,
    .quiz-bubble.level-5 { transform: scale(1.10); }

    .quiz-bubble.active {
      background: #f48bbd;
      border-color: #f48bbd;
      box-shadow: 0 0 0 6px rgba(244,139,189,0.22);
    }
    .quiz-bubble.active::after {
      background: #fff;
    }

    .quiz-nav {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .quiz-nav button {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #e0d0ea;
      background: #fff;
      padding: 9px 12px;
      font-size: 14px;
      cursor: pointer;
    }

    .quiz-nav button.primary {
      background: #f48bbd;
      border-color: #f48bbd;
      color: #fff;
      font-weight: 600;
    }

    .quiz-nav button:disabled {
      opacity: 0.4;
      cursor: default;
    }

    .quiz-note {
      margin-top: 8px;
      font-size: 12px;
      color: #888;
      text-align: center;
    }

    .ad-section-top {
      margin-top: 20px;
      text-align: center;
    }

    .ad-box-top {
      width: 300px;
      height: 100px;
      margin: 0 auto;
      background: #f1e4f4;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: #666;
    }
  </style>
</head>
<body>

<header class="header">
  <div class="logo">Affinia</div>
  <button class="menu-toggle" onclick="toggleMenu()">☰</button>
</header>

<nav id="sideMenu" class="side-menu">
  <button class="close-btn" onclick="toggleMenu()">×</button>
  <ul>
    <li><a href="index.html">診断トップ</a></li>
    <li><a href="types.html">タイプ一覧</a></li>
    <li><a href="compatibility.html">タイプ相性</a></li>
    <li><a href="about.html">Affiniaとは</a></li>
  </ul>
</nav>

<main>
  <div class="top-wrapper">

    <!-- ヒーローエリア -->
    <section class="hero-card">
      <div class="hero-kicker">AIタイプ診断</div>
      <h1 class="hero-title">性格にとらわれず、自分らしい今を。</h1>
      <p class="hero-copy">
        たった1分で、いまのあなたに近い Affinia タイプをチェックできます。
      </p>
      <div class="hero-meta">
        <span>質問は全部で9問</span>
        <span>タップするだけで回答OK</span>
        <span>すぐにタイプとまとめを表示</span>
      </div>
      <button class="hero-main-btn" onclick="scrollToQuiz()">診断をはじめる</button>
      <p class="hero-sub">※ 深呼吸するくらいの気持ちで、直感で選んで大丈夫です。</p>
    </section>

    <!-- 上部広告枠（オプション） -->
    <section class="ad-section-top">
      <div class="ad-box-top">広告エリア（横長）</div>
    </section>

    <!-- 診断エリア -->
    <section id="quiz-section" class="quiz-section">
      <div class="quiz-card">
        <div class="quiz-header">
          <div class="quiz-header-top">
            <div class="quiz-title">Affiniaタイプ診断</div>
            <div class="quiz-step" id="quiz-step">1 / 9</div>
          </div>
          <div class="quiz-progress-wrapper">
            <div class="quiz-progress-bar-bg">
              <div id="quiz-progress-bar" class="quiz-progress-bar"></div>
            </div>
            <div id="quiz-progress-text" class="quiz-progress-text">診断の進行度 0%</div>
          </div>
        </div>

        <div class="quiz-body">
          <div id="quiz-question" class="quiz-question">
            <!-- 質問文 -->
          </div>

          <div class="quiz-scale">
            <div class="quiz-bubbles" id="quiz-bubbles">
              <!-- 丸ボタン5つをJSで生成 -->
            </div>
            <div id="quiz-label-left" class="quiz-label"></div>
            <div id="quiz-label-right" class="quiz-label"></div>
          </div>

          <div class="quiz-nav">
            <button id="btn-prev" onclick="prevQuestion()">もどる</button>
            <button id="btn-next" class="primary" onclick="nextQuestion()" disabled>次へ</button>
          </div>

          <p class="quiz-note">
            どちらかと言えば「こっちかな」と思うほうで選んでください。
          </p>
        </div>
      </div>
    </section>
  </div>
</main>

<footer class="footer">
  <div>
    <a href="about.html">Affiniaとは</a>　
    <a href="types.html">タイプ一覧</a>　
    <a href="compatibility.html">タイプ相性</a>　
    <a href="terms.html">利用規約</a>　
    <a href="privacy.html">プライバシー</a>
  </div>
  <p>© 2025 Affinia</p>
</footer>

<script>
  function toggleMenu() {
    const menu = document.getElementById("sideMenu");
    menu.classList.toggle("open");
  }

  function scrollToQuiz() {
    const el = document.getElementById("quiz-section");
    if (el) {
      el.scrollIntoView({ behavior: "smooth" });
    }
  }

  // 質問データ（9問）
  const QUESTIONS = [
    {
      id: 1,
      axis: "E", // 外向 / 内向
      text: "休みの日、テンションが上がるのはどっち？",
      leftLabel: "少人数で、ゆっくり過ごしたい",
      rightLabel: "人と会って、わいわいしたい"
    },
    {
      id: 2,
      axis: "E",
      text: "初対面の人と話すときの感覚は？",
      leftLabel: "仲良くなるまで時間をかけたい",
      rightLabel: "とりあえず話してみて距離をつめたい"
    },
    {
      id: 3,
      axis: "N", // 直感 / 現実
      text: "新しいことを始めるときの決め手は？",
      leftLabel: "今できることや現実的なラインを見てから",
      rightLabel: "ワクワクするかどうか、直感を優先したい"
    },
    {
      id: 4,
      axis: "N",
      text: "将来のことを考えるときは？",
      leftLabel: "近い未来をちゃんと固めておきたい",
      rightLabel: "遠くのイメージからふんわり考えたい"
    },
    {
      id: 5,
      axis: "F", // 感情 / ロジック
      text: "人の相談に乗るとき、まず意識するのは？",
      leftLabel: "気持ちに寄りそって安心させたい",
      rightLabel: "状況を整理して解決策を一緒に考えたい"
    },
    {
      id: 6,
      axis: "F",
      text: "ケンカしたとき、優先したいのは？",
      leftLabel: "関係を守ること・空気を元に戻すこと",
      rightLabel: "お互いの言い分をはっきり整理すること"
    },
    {
      id: 7,
      axis: "J", // きっちり / ゆるく
      text: "予定の立て方、どっちがしっくりくる？",
      leftLabel: "事前に決めておいて、できるだけその通りに動きたい",
      rightLabel: "その場の流れで決めていく方が気楽"
    },
    {
      id: 8,
      axis: "J",
      text: "締切や課題に対するスタンスは？",
      leftLabel: "早めに片づけて、心を軽くしておきたい",
      rightLabel: "ギリギリまで温めて、一気に仕上げたい"
    },
    {
      id: 9,
      axis: "E", // バランス調整用の1問
      text: "にぎやかな場所と静かな場所、続くとしんどいのは？",
      leftLabel: "人が多い・音が多い場所が続くと疲れやすい",
      rightLabel: "静かすぎる環境が続くと逆に落ち着かない"
    }
  ];

  const TOTAL = QUESTIONS.length;
  let currentIndex = 0;
  const answers = {}; // question.id -> 1〜5

  // 丸ボタン生成
  const bubblesContainer = document.getElementById("quiz-bubbles");
  const bubbles = [];

  for (let level = 1; level <= 5; level++) {
    const b = document.createElement("button");
    b.type = "button";
    b.className = "quiz-bubble level-" + level;
    b.dataset.level = String(level);
    b.addEventListener("click", () => selectLevel(level));
    bubblesContainer.appendChild(b);
    bubbles.push(b);
  }

  function renderQuestion() {
    const q = QUESTIONS[currentIndex];
    const stepEl = document.getElementById("quiz-step");
    const qTextEl = document.getElementById("quiz-question");
    const leftLabelEl = document.getElementById("quiz-label-left");
    const rightLabelEl = document.getElementById("quiz-label-right");
    const progressBar = document.getElementById("quiz-progress-bar");
    const progressText = document.getElementById("quiz-progress-text");
    const btnPrev = document.getElementById("btn-prev");
    const btnNext = document.getElementById("btn-next");

    stepEl.textContent = (currentIndex + 1) + " / " + TOTAL;
    qTextEl.textContent = q.text;
    leftLabelEl.textContent = q.leftLabel;
    rightLabelEl.textContent = q.rightLabel;

    const progress = Math.round(((currentIndex) / TOTAL) * 100);
    progressBar.style.width = progress + "%";
    progressText.textContent = "診断の進行度 " + progress + "%";

    // 前へボタン
    btnPrev.disabled = currentIndex === 0;

    // 選択済みあれば反映
    const selectedLevel = answers[q.id];
    bubbles.forEach(b => {
      b.classList.toggle("active", Number(b.dataset.level) === selectedLevel);
    });
    btnNext.disabled = !selectedLevel;
    btnNext.textContent = currentIndex === TOTAL - 1 ? "結果を見る" : "次へ";
  }

  function selectLevel(level) {
    const q = QUESTIONS[currentIndex];
    answers[q.id] = level;
    bubbles.forEach(b => {
      b.classList.toggle("active", Number(b.dataset.level) === level);
    });
    document.getElementById("btn-next").disabled = false;
  }

  function prevQuestion() {
    if (currentIndex === 0) return;
    currentIndex--;
    renderQuestion();
  }

  function nextQuestion() {
    const q = QUESTIONS[currentIndex];
    if (!answers[q.id]) return;

    if (currentIndex < TOTAL - 1) {
      currentIndex++;
      renderQuestion();
    } else {
      // 全問回答済 → タイプ判定して結果ページへ
      const typeCode = calcAffiniaTypeCode();
      sessionStorage.setItem("affiniaTypeCode", typeCode);
      location.href = "result.html?code=" + encodeURIComponent(typeCode);
    }
  }

  // 簡易的なタイプ判定ロジック（軸ごとにスコア集計 → 16タイプにマッピング）
  function calcAffiniaTypeCode() {
    const axisScore = { E: 0, N: 0, F: 0, J: 0 };

    QUESTIONS.forEach(q => {
      const level = answers[q.id];
      if (!level) return;
      // 左(1)寄りは -2〜-1 / 真ん中3は0 / 右(5)寄りは +1〜+2 のイメージ
      const delta = level - 3; // -2〜+2
      axisScore[q.axis] += delta;
    });

    const side = (axis, leftHigh, rightHigh) => {
      return axisScore[axis] >= 0 ? rightHigh : leftHigh;
    };

    // 各軸で2択（4軸で16パターン）
    const eSide = side("E", "IN", "EX");   // 内向 / 外向
    const nSide = side("N", "REAL", "VISION");
    const fSide = side("F", "HEART", "LOGIC");
    const jSide = side("J", "PLAN", "FLOW");

    const key = `${eSide}-${nSide}-${fSide}-${jSide}`;

    // 16パターンを Affinia コードに割り当て
    const map = {
      "IN-REAL-HEART-PLAN": "A1", // ツンデレニャンコ
      "EX-VISION-HEART-PLAN": "A2", // 情熱ヒーロー
      "IN-VISION-LOGIC-PLAN": "A3", // クールブレイン
      "EX-REAL-HEART-FLOW": "A4",   // ハッピーバニー

      "IN-REAL-HEART-FLOW": "B1",   // 癒し天使
      "EX-VISION-HEART-FLOW": "B2", // おちゃめキツネ
      "IN-VISION-LOGIC-FLOW": "B3", // 博識フクロウ
      "EX-REAL-LOGIC-PLAN": "B4",   // ゴージャスプリンス

      "IN-VISION-HEART-PLAN": "C1", // 夢見るユニコーン
      "EX-REAL-HEART-PLAN": "C2",   // 頑張りミツバチ
      "IN-REAL-HEART-FLOW": "C3",   // もじもじヒツジ（※調整可）
      "EX-VISION-HEART-FLOW": "C4", // ドジっ子リス

      "EX-VISION-LOGIC-FLOW": "D1", // パンクハリネズミ
      "IN-REAL-LOGIC-FLOW": "D2",   // マイペースナマケモノ
      "EX-REAL-HEART-FLOW": "D3",   // 健気ワンコ
      "EX-VISION-HEART-PLAN": "D4"  // キラキラアイドル
    };

    return map[key] || "A1"; // 万が一マップ漏れたときはとりあえずA1
  }

  // 初期描画
  renderQuestion();
</script>

</body>
</html>
